# 컨피그맵과 시크릿: 애플리케이션 설정

## 7장 내용

- 컨테이너의 주 프로세스 변경
- 애플리케이션에 명령줄 옵션 전달
- 애플리케이션에 노출되는 환경변수 설정
- 컨피그맵으로 애플리케이션 설정
- 시크릿으로 민감한 정보 전달

## 1. 컨테이너화된 애플리케이션 설정

- 일반적으로 명령줄 인수로 애플리케이션에 필요한 설정을 넘겨주는 것으로 시작한다.
- 또 다른 방법은 환경변수를 사용하는 것: 설정을 파일이나 명령줄 인수에서 읽는 대신 특정 환경변수의 값을 찾는다. 예를 들어 mysql 공식 컨테이너 이미지는 루트 슈퍼 사용자 계정의 암호를 설정할 때 MYSQL_ROOT_PASSWORD 환경변수를 사용한다.
- 코드에 중요 내용을 포함하는 것은 보안에 좋지 못하다.
- 컨피그맵: 설정 데이터를 저장하는 쿠버네티스 리소스
- 시크릿: 자격증명, 개인 암호화 키 등의 데이터를 처리하기 위한 오브젝트

## 2. 명령줄 인자 전달

### 2.1 도커에서 명령와 인자 정의

명령어와 인자, 두 부분으로 나누어져 있다.  
**ENTRYPOINT와 CMD 이해**

- ENTRYPOINT: 컨테이너가 시작될 때 호출될 명령어 정의
- CMD: ENTRYPOINT에 전달되는 인자를 정의한다.
- 또는 추가 인자를 지정해 Dockerfile 안의 CMD에 정의된 값을 재정의한다.
  ```bash
  docker run <image> <arguments>
  ```

**shell과 exec 형식 간의 차이점**  
두 명령어는 두 가지 서로 다른 형식을 지원한다.

```bash
ENTRYPOINT node app.js # shell 형식
ENTRYPOINT ["node", "app.js"] # exec 형식
```

차이점은 내부에서 정의된 명령을 shell로 호출하는지 여부이다. exec 형식은 셸 내부가 아니라 컨테이너 내부에서 node 프로세스를 직접 실행한다.

```bash
docker exec 4675d ps x
docker exec -it e4bad ps x # shell로 실행했을 때
```

/bin/sh -c node app.js 라는 프로세스가 생성돼 있음을 볼 수 있다.
